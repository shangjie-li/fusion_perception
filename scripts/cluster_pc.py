# -*- coding: UTF-8 -*-

import time
import numpy as np
import matplotlib.pyplot as plt
from sklearn.cluster import DBSCAN

from fit_3d_model import transform_2d_point_clouds

def cluster_2d_point_clouds_using_DBSCAN(xs, ys, eps=0.5, min_samples=5, leaf_size=30):
    # 功能：对平面点云聚类
    #      应用DBSCAN(Density-Based Spatial Clustering of Applications with Noise)基于密度的聚类算法
    #      将具有足够密度的点云划分为簇，无需给定聚类中心的数量
    # 输入：xs <class 'numpy.ndarray'> (n,) 代表横坐标
    #      ys <class 'numpy.ndarray'> (n,) 代表纵坐标
    #      eps <class 'float'> 将两点视为同类的最大距离，该值不决定类中最远的两个点的距离
    #      min_samples <class 'int'> 最少聚类点数
    #      leaf_size <class 'int'> 传递给ball_tree或kd_tree的参数，会影响查找的速度
    # 输出：labels <class ''> 存储所有点所在的聚类中心ID，其中噪点为-1
    
    pts = np.array((xs, ys)).T
    
    # DBSCAN类输入的参数：
    #   eps: float, default=0.5 将两点视为同类的最大距离，该值不决定类中最远的两个点的距离
    #   min_samples: int, default=5 最少聚类点数
    #   metric: string, or callable, default=’euclidean’ 计算距离时使用的度量方式，一般情况下无需设置
    #   metric_params: dict, default=None 度量的关键参数，一般情况下无需设置
    #   algorithm: {‘auto’, ‘ball_tree’, ‘kd_tree’, ‘brute’}, default=’auto’ 查找临近点的算法，一般情况下无需设置
    #   leaf_size: int, default=30 传递给ball_tree或kd_tree的参数，会影响查找的速度
    #   p: float, default=None 用于Minkowski度量，一般情况下无需设置
    #   n_jobs: int, default=None 并行运行，一般情况下无需设置
    # DBSCAN类保存的结果：
    #   db.core_sample_indices_存储所有被聚类点的索引
    #   db.components_存储所有被聚类点的坐标
    #   db.labels_存储所有点所在的聚类中心ID，其中噪点为-1
    
    # 设置聚类密度：在0.5m范围内，点云数量超过5个
    # 经测试，当目标点云数量为500时，聚类过程耗时约3ms
    db = DBSCAN(eps=eps, min_samples=min_samples, leaf_size=leaf_size).fit(pts)
    
    # labels <class 'numpy.ndarray'> (n,)
    labels = db.labels_
    
    return labels

def cluster_point_clouds(xs, ys, zs):
    # 功能：对三维点云聚类
    #      应用DBSCAN(Density-Based Spatial Clustering of Applications with Noise)基于密度的聚类算法
    #      将具有足够密度的点云划分为簇，无需给定聚类中心的数量
    # 输入：xs <class 'numpy.ndarray'> (n,) 代表X坐标
    #      ys <class 'numpy.ndarray'> (n,) 代表Y坐标
    #      zs <class 'numpy.ndarray'> (n,) 代表Z坐标
    # 输出：xsc <class 'numpy.ndarray'> (n,) 有聚类结果时，代表聚类点簇的X坐标，否则为输入的X坐标
    #      ysc <class 'numpy.ndarray'> (n,) 有聚类结果时，代表聚类点簇的Y坐标，否则为输入的Y坐标
    #      zsc <class 'numpy.ndarray'> (n,) 有聚类结果时，代表聚类点簇的Z坐标，否则为输入的Z坐标
    #      is_clustered <class 'bool'> 是否有聚类结果
    
    pts = np.array((xs, ys, zs)).T
    
    # 对平面点云聚类
    labels = cluster_2d_point_clouds_using_DBSCAN(xs, ys)
    
    # 若无聚类结果，则退出
    if labels.max() < 0:
        xsc = xs
        ysc = ys
        zsc = zs
        is_clustered = False
    else:
        # 滤除离群点，并保留最大的聚类簇
        best_label = -1
        num_best = 0
        for label in range(labels.max() + 1):
            num = np.where(labels == label)[0].shape[0]
            if num > num_best:
                best_label = label
                num_best = num
        
        # idxs <class 'numpy.ndarray'> (n,)
        idxs = np.where(labels == best_label)[0]
        
        xsc = xs[idxs]
        ysc = ys[idxs]
        zsc = zs[idxs]
        is_clustered = True
    
    return xsc, ysc, zsc, is_clustered
    
if __name__ == '__main__':
    xs1 = [3.15, 2.37, 2.36, 2.31, 2.33, 2.31, 2.33, 2.32, 2.32, 2.28, 2.3, 2.31, 2.3, 2.3, 2.3, 2.31, 2.36, 2.28, 3.5, 3.57, 3.43, 3.37, 3.34, 3.24, 3.29, 3.16, 3.05, 2.99, 2.95,
     2.86, 2.87, 2.76, 2.66, 2.55, 2.45, 2.4, 2.38, 2.35, 2.33, 2.29, 2.33, 2.36, 2.34, 2.34, 2.28, 2.29, 2.27, 2.29, 2.27, 2.27, 2.27, 3.65, 3.54, 3.58, 3.45, 3.45, 3.36, 3.34,
      3.25, 3.14, 3.07, 3.04, 2.96, 2.83, 2.87, 2.74, 2.79, 2.72, 2.65, 2.65, 2.55, 2.57, 2.51, 2.45, 2.46, 2.4, 2.37, 2.34, 2.34, 2.31, 2.31, 2.31, 2.3, 2.32, 2.31, 2.36, 2.29,
       2.27, 3.54, 3.59, 3.47, 3.36, 3.25, 3.15, 3.06, 3.06, 2.93, 2.94, 2.83, 2.78, 2.75, 2.68, 2.66, 2.63, 2.55, 2.54, 2.45, 2.37, 2.34, 2.32, 2.29, 2.29, 2.29, 2.3, 2.29, 2.26,
        2.27, 2.29, 2.28, 2.27, 3.64, 3.67, 3.52, 3.56, 3.43, 3.45, 3.34, 3.33, 3.26, 3.24, 3.15, 3.16, 3.04, 3.05, 2.96, 2.95, 2.86, 2.84, 2.76, 2.74, 2.66, 2.68, 2.62, 2.59, 2.53,
         2.55, 2.44, 2.45, 2.37, 2.34, 2.35, 2.36, 2.33, 2.31, 2.31, 2.3, 2.32, 2.34, 2.28, 2.27, 2.28, 2.28, 3.84, 3.73, 3.75, 3.64, 3.67, 3.56, 3.57, 3.47, 3.49, 3.43, 3.41, 3.35,
          3.32, 3.34, 3.31, 3.29, 3.24, 3.15, 3.05, 2.99, 3.05, 2.94, 2.89, 2.87, 2.84, 2.8, 2.75, 2.75, 2.65, 2.6, 2.53, 2.48, 2.42, 2.41, 2.36, 2.33, 2.35, 2.33, 2.35, 2.34, 2.32,
           2.31, 2.29, 2.34, 2.34, 2.33, 4.04, 3.92, 3.96, 3.88, 3.84, 3.82, 3.72, 3.78, 3.63, 3.65, 3.52, 3.55, 3.48, 3.55, 3.54, 3.44, 3.43, 3.43, 3.33, 3.3, 3.36, 3.29, 3.24,
            3.24, 3.17, 3.15, 3.08, 3.09, 3.04, 3.03, 2.94, 2.9, 2.97, 2.85, 2.79, 2.83, 2.79, 2.73, 2.72, 2.75, 2.65, 2.67, 2.64, 2.59, 2.58, 2.53, 2.57, 2.48, 2.47, 2.43, 2.39,
             2.32, 2.35, 2.24, 3.91, 3.9, 3.82, 3.81, 3.87, 3.76, 3.76, 3.78, 3.69, 3.68, 3.64, 3.65, 3.59, 3.55, 3.54, 3.4, 3.39, 3.45, 3.46, 3.44, 3.4, 3.33, 3.33, 3.32, 3.22,
              3.24, 3.13, 3.14, 3.01, 3.07, 2.96, 2.5, 2.55, 2.46, 2.42, 2.47, 2.48, 2.47, 2.46, 2.47, 2.47, 2.47, 2.46, 2.34, 2.29, 2.23, 2.18, 5.95, 5.82, 5.73, 3.8, 3.82, 3.74,
               3.77, 3.61, 3.53, 3.43, 3.23, 2.95, 2.84, 2.79, 2.71, 2.55, 2.52, 2.51, 2.51, 2.5, 2.51, 2.53, 2.5, 5.83, 5.72, 5.54, 5.41, 5.28, 5.18, 5.12, 3.74, 3.77, 3.72, 3.73,
                3.66, 3.68, 3.62, 3.59, 3.49, 3.54, 3.47, 3.45, 3.37, 3.23, 3.15, 3.06, 2.91, 2.85, 2.86, 2.77, 2.74, 2.65, 2.56, 2.55, 2.53, 2.54, 2.56, 2.53, 2.56, 2.54, 5.43,
                 5.33, 5.27, 5.17, 3.76, 3.72, 3.67, 3.64, 3.62, 3.55, 3.53, 3.53, 3.43, 3.44, 3.33, 3.33, 3.23, 3.23, 3.14, 3.14, 3.1, 3.04, 3.02, 2.94, 2.95, 2.92, 2.85, 2.85,
                  2.73, 2.77, 2.71, 2.61, 2.64, 2.57, 2.56, 2.56]
    ys1 = [19.08, 14.36, 14.55, 11.86, 13.8, 13.99, 14.38, 14.67, 14.83, 11.93, 12.31, 12.55, 13.35, 13.61, 13.77, 14.41, 14.9, 12.99, 11.29, 11.32, 11.29, 11.28, 11.32, 11.29,
     11.31, 11.29, 11.29, 11.3, 11.31, 11.29, 11.31, 11.31, 11.33, 11.38, 11.44, 11.5, 11.56, 11.66, 11.76, 13.39, 13.79, 14.58, 14.83, 15.19, 11.99, 12.02, 12.19, 12.47, 12.64,
      12.73, 13.0, 11.56, 11.35, 11.47, 11.34, 11.46, 11.34, 11.44, 11.45, 11.36, 11.29, 11.45, 11.47, 11.37, 11.46, 11.35, 11.46, 17.64, 11.39, 11.63, 11.42, 11.67, 11.71, 11.45,
       11.75, 11.5, 11.54, 11.67, 11.74, 12.37, 12.51, 12.82, 13.08, 13.44, 13.7, 15.09, 11.85, 12.47, 11.4, 11.46, 11.4, 11.39, 11.39, 11.36, 11.37, 11.41, 11.39, 11.43, 11.42,
        17.77, 11.43, 11.44, 11.52, 11.64, 11.6, 11.75, 11.73, 11.77, 11.85, 11.92, 13.09, 13.4, 13.71, 14.39, 12.04, 12.13, 12.38, 12.75, 12.95, 13.16, 11.54, 11.7, 11.46, 11.64,
         11.46, 11.62, 11.43, 11.62, 11.44, 11.6, 11.44, 11.62, 11.45, 11.62, 11.45, 11.64, 11.47, 11.66, 11.49, 11.68, 11.54, 11.7, 11.74, 11.59, 11.64, 11.79, 11.69, 11.84, 11.76,
          11.87, 11.94, 12.02, 12.12, 12.25, 12.44, 12.63, 14.05, 14.48, 12.83, 13.03, 13.33, 13.63, 12.17, 11.9, 12.12, 11.82, 12.08, 11.8, 12.07, 11.79, 12.04, 13.74, 14.42,
           11.77, 13.73, 14.36, 14.42, 14.59, 11.77, 11.77, 11.78, 13.69, 13.75, 11.79, 18.14, 11.8, 11.82, 13.76, 11.83, 13.77, 11.87, 11.91, 11.93, 11.98, 12.03, 12.33, 12.15,
            12.36, 12.51, 12.66, 12.82, 13.01, 13.21, 13.42, 13.58, 13.99, 14.3, 14.58, 12.9, 12.73, 12.88, 13.63, 12.69, 13.7, 12.71, 12.74, 12.64, 14.33, 21.12, 12.63, 14.07,
             14.13, 14.52, 21.12, 12.05, 14.51, 12.03, 14.41, 14.48, 14.63, 12.02, 14.65, 18.95, 12.04, 14.13, 18.88, 12.05, 18.9, 12.07, 13.8, 13.85, 12.09, 12.78, 13.79, 12.11,
              12.12, 12.68, 13.78, 12.16, 12.66, 12.74, 13.26, 12.18, 12.22, 13.1, 15.33, 12.26, 12.74, 12.86, 12.92, 14.43, 12.97, 12.87, 14.59, 12.8, 12.88, 13.69, 12.88, 12.97,
               13.75, 14.17, 13.19, 13.8, 14.36, 14.64, 14.24, 14.63, 12.97, 14.49, 14.52, 14.65, 14.8, 14.84, 14.46, 14.81, 14.86, 14.8, 14.84, 12.96, 13.08, 14.69, 14.74, 14.72,
                12.89, 12.93, 12.79, 12.86, 13.0, 13.29, 13.49, 13.74, 14.06, 14.34, 14.65, 14.92, 12.9, 12.91, 12.96, 13.04, 31.58, 31.51, 31.61, 13.0, 13.67, 13.06, 13.77, 13.74,
                 13.75, 13.75, 19.36, 13.76, 13.61, 13.7, 13.56, 13.01, 13.09, 13.55, 13.8, 14.08, 14.38, 14.54, 14.63, 26.75, 26.75, 26.75, 19.9, 19.81, 19.88, 19.96, 19.65, 13.09,
                  13.15, 13.64, 19.62, 13.29, 13.45, 19.59, 13.15, 13.69, 19.54, 13.72, 19.54, 13.06, 13.05, 13.06, 13.06, 13.1, 13.34, 13.17, 13.23, 13.15, 13.18, 13.51, 13.69,
                   13.98, 14.13, 14.24, 14.41, 14.62, 19.86, 19.79, 19.83, 19.88, 19.98, 13.26, 20.06, 13.24, 13.81, 19.99, 13.2, 13.75, 13.19, 13.69, 13.18, 13.67, 13.19, 13.66,
                    13.2, 13.62, 13.67, 13.2, 13.65, 13.19, 13.66, 13.73, 13.2, 13.77, 13.24, 13.76, 13.84, 13.25, 13.97, 13.36, 13.61, 13.85]
    zs1 = [1.91, 1.78, 1.81, 1.69, 1.72, 1.65, 1.7, 1.73, 1.66, 1.7, 1.53, 1.56, 1.58, 1.61, 1.54, 1.61, 1.58, 1.54, 1.44, 1.45, 1.44, 1.44, 1.44, 1.43, 1.44, 1.43, 1.43, 1.43, 1.43,
     1.42, 1.43, 1.42, 1.42, 1.43, 1.43, 1.44, 1.44, 1.46, 1.47, 1.5, 1.46, 1.55, 1.48, 1.52, 1.42, 1.5, 1.45, 1.48, 1.5, 1.43, 1.46, 1.33, 1.36, 1.32, 1.35, 1.32, 1.37, 1.33, 1.35,
      1.35, 1.36, 1.34, 1.34, 1.36, 1.33, 1.36, 1.3, 1.45, 1.36, 1.32, 1.36, 1.32, 1.32, 1.36, 1.33, 1.37, 1.37, 1.35, 1.35, 1.32, 1.37, 1.36, 1.39, 1.43, 1.37, 1.42, 1.37, 1.4,
       1.24, 1.25, 1.24, 1.24, 1.23, 1.25, 1.25, 1.23, 1.23, 1.23, 1.23, 1.35, 1.25, 1.27, 1.24, 1.25, 1.24, 1.26, 1.25, 1.26, 1.26, 1.27, 1.23, 1.26, 1.29, 1.27, 1.21, 1.22, 1.24,
        1.28, 1.3, 1.32, 1.19, 1.13, 1.18, 1.12, 1.18, 1.12, 1.17, 1.12, 1.17, 1.11, 1.17, 1.11, 1.17, 1.11, 1.17, 1.11, 1.16, 1.11, 1.17, 1.11, 1.17, 1.11, 1.11, 1.17, 1.18, 1.12,
         1.18, 1.12, 1.18, 1.19, 1.17, 1.14, 1.14, 1.16, 1.17, 1.19, 1.15, 1.19, 1.17, 1.15, 1.18, 1.2, 1.03, 1.08, 1.02, 1.07, 1.02, 1.07, 1.01, 1.06, 1.01, 1.06, 1.11, 1.06, 1.06,
          1.1, 1.11, 1.12, 1.06, 1.06, 1.05, 1.05, 1.06, 1.05, 1.16, 1.05, 1.05, 1.05, 1.05, 1.05, 1.06, 1.06, 1.06, 1.06, 1.07, 1.02, 1.08, 1.09, 1.07, 1.08, 1.06, 1.07, 1.09, 1.1,
           1.12, 1.07, 1.09, 1.11, 0.95, 0.99, 0.92, 0.97, 0.99, 0.98, 0.99, 0.99, 0.98, 1.02, 1.1, 0.98, 1.0, 1.0, 1.03, 1.1, 1.01, 1.03, 1.01, 1.02, 1.03, 1.04, 1.0, 1.04, 1.1,
            1.0, 1.0, 1.1, 1.0, 1.1, 1.0, 0.97, 0.98, 1.0, 0.98, 0.97, 1.0, 1.0, 0.97, 0.97, 1.01, 0.97, 0.98, 0.93, 1.01, 1.01, 1.0, 0.98, 1.01, 0.97, 0.98, 0.99, 1.01, 0.99, 0.92,
             0.95, 0.9, 0.84, 0.89, 0.92, 0.85, 0.9, 0.92, 0.86, 0.9, 0.93, 0.95, 0.92, 0.88, 0.92, 0.94, 0.94, 0.86, 0.87, 0.87, 0.94, 0.96, 0.87, 0.96, 0.87, 0.84, 0.93, 0.95,
              0.95, 0.95, 0.83, 0.83, 0.9, 0.9, 0.84, 0.85, 0.87, 0.88, 0.9, 0.92, 0.94, 0.96, 0.91, 0.91, 0.91, 0.91, 1.08, 1.08, 1.08, 0.77, 0.81, 0.77, 0.81, 0.81, 0.81, 0.81,
               0.89, 0.81, 0.8, 0.8, 0.79, 0.76, 0.76, 0.79, 0.8, 0.82, 0.84, 0.76, 0.85, 0.92, 0.92, 0.92, 0.81, 0.8, 0.81, 0.81, 0.79, 0.69, 0.7, 0.72, 0.79, 0.7, 0.71, 0.79,
                0.7, 0.72, 0.79, 0.72, 0.79, 0.69, 0.69, 0.69, 0.69, 0.69, 0.7, 0.69, 0.69, 0.69, 0.69, 0.71, 0.72, 0.73, 0.65, 0.74, 0.67, 0.67, 0.69, 0.68, 0.68, 0.69, 0.68,
                 0.62, 0.69, 0.62, 0.56, 0.68, 0.62, 0.56, 0.62, 0.56, 0.61, 0.55, 0.61, 0.55, 0.61, 0.55, 0.55, 0.61, 0.55, 0.61, 0.55, 0.55, 0.61, 0.56, 0.61, 0.55, 0.56, 0.61,
                  0.56, 0.62, 0.63, 0.64]
    
    xs2 = [-2.35, -2.3, -2.15, -2.09, -2.02, -1.95, -1.28, -1.24, -1.2, -1.16, -1.11, -1.07, -1.04, -1.55, -0.94, -0.91, -1.32, -1.23, -1.18, -1.09, -1.01, -0.95, -0.89, -0.81, -0.74, -0.57,
     -0.54, -0.65, -0.57, -2.8, -2.73, -2.5, -1.68, -1.63, -1.58, -1.54, -1.49, -1.44, -1.41, -1.36, -1.32, -1.28, -1.25, -1.2, -1.17, -1.12, -1.08, -1.04, -1.0, -0.95, -0.91, -0.88, -0.83,
      -0.79, -0.77, -0.73, -0.68, -0.64, -0.61, -0.99, -0.95, -0.9, -0.87, -0.83, -0.78, -0.75, -0.71, -0.68, -0.64, -0.6, -0.56, -0.53, -0.49, -0.45, -0.49, -3.02, -2.89, -1.81, -1.77, -1.72,
       -1.68, -1.64, -1.59, -1.55, -1.51, -1.46, -1.43, -1.38, -1.35, -1.3, -1.26, -1.22, -1.18, -1.14, -1.1, -1.06, -1.03, -1.27, -1.23, -1.19, -1.15, -1.12, -1.08, -1.03, -0.99, -0.96, -0.92,
        -0.88, -0.84, -0.8, -0.77, -0.73, -0.69, -0.65, -0.61, -0.54, -0.51, -0.47, -0.43, -0.39, -0.34, -3.16, -1.89, -1.81, -1.77, -1.73, -1.71, -1.68, -1.6, -1.56, -1.51, -1.47, -1.42, -1.38,
         -1.35, -1.31, -0.56, -0.53, -0.49, -0.44, -0.41, -0.37, -0.85, -0.82, -0.78, -0.75, -0.71, -0.66, -0.62, -1.98, -1.92, -1.89, -1.85, -1.81, -1.79, -1.76, -1.72, -0.7, -0.55, -0.51,
          -0.48, -0.44, -0.42, -0.36, -0.31, -1.57, -1.54, -1.5, -1.47, -1.42, -1.38, -1.34, -1.3, -1.27, -1.23, -1.18, -1.15, -1.12, -1.08, -1.03, -1.0, -0.96, -0.92, -1.81, -1.76, -1.79,
           -0.34, -0.3, -0.26, -0.21, -1.11, -1.0, -0.93, -0.9, -0.87, -0.88, -0.83, -0.8, -0.75, -0.67, -0.64, -0.6, -0.53, -0.5, -1.7, -1.81, -1.63, -1.59, -1.51, -1.46, -1.43, -1.38, -1.34,
            -1.31, -1.28, -1.25, -1.22, -2.02, -1.95, -1.92, -1.86, -1.82, -1.78, -1.74, -0.62, -0.54, -0.51, -0.47, -0.43, -0.32, -0.28, -0.23, -1.26, -1.13, -1.1, -1.07, -1.03, -0.99, -0.95,
             -0.85, -0.8, -0.76, -0.73, -0.7, -0.65, -1.78, -1.74, -1.86, -1.65, -1.55, -1.4, -1.34, -1.29, -2.13, -2.07, -1.99, -1.95, -1.9, -1.85, -0.87, -0.83, -0.8, -0.75, -0.72, -0.68,
              -0.64, -0.61, -0.53, -0.51, -0.47, -0.43, -0.28, -0.24, -1.39, -1.35, -1.31, -1.28, -1.23, -1.21, -1.16, -1.13, -1.09, -1.06, -1.02, -0.98, -0.95, -0.9, -1.9, -1.87, -1.82, -1.77,
               -1.73, -1.69, -1.65, -1.61, -1.58, -1.53, -1.5, -1.46, -1.43, -2.17, -2.13, -2.02, -1.98, -1.93, -0.39, -0.34, -0.25, -0.21, -0.17, -0.97, -0.95, -0.91, -0.87, -0.83, -0.8, -0.76,
                -0.73, -0.7, -0.66, -0.63, -0.59, -0.52, -0.49, -0.45, -0.42, -1.44, -1.4, -1.37, -1.33, -1.29, -1.25, -1.23, -1.18, -1.16, -1.12, -1.09, -1.06, -1.01, -1.82, -1.79, -1.75, -1.71,
                 -1.67, -1.63, -1.6, -1.55, -1.52, -1.48, -3.44, -2.07, -2.03, -1.99, -1.95, -1.9, -1.88, -0.62, -0.59, -0.52, -0.49, -0.45, -0.41, -0.38, -0.34, -0.29, -0.2, -0.16, 0.0, -1.11,
                  -1.07, -1.04, -1.0, -0.96, -0.93, -0.89, -0.86, -0.84, -0.79, -0.75, -0.73, -0.69, -0.65, -1.49, -1.46, -1.42, -1.39, -1.36, -1.31, -1.28, -1.25, -1.21, -1.17, -1.14, -1.88,
                   -1.84, -1.8, -1.76, -1.73, -1.69, -1.64, -1.61, -1.56, -1.53, -3.29, -3.25, -2.09, -2.03, -2.0, -1.97, -1.93, -0.28, -0.24, -0.18, -0.06, 0.02, -0.8, -0.76, -0.73, -0.71,
                    -0.67, -0.64, -0.6, -0.56, -0.54, -0.51, -0.43, -0.4, -0.36, -0.32, -1.2, -1.18, -1.15, -1.11, -1.08, -1.04, -1.01, -0.97, -0.94, -0.91, -0.87, -0.83, -1.6, -1.55, -1.52,
                     -1.49, -1.46, -1.42, -1.39, -1.35, -1.3, -1.27, -1.26, -1.94, -1.9, -1.87, -1.82, -1.78, -1.75, -1.71, -1.67, -1.63, -3.18, -2.11, -2.06, -2.01, -1.99, -0.41, -0.38, -0.34,
                      -0.3, -0.26, -0.21, -0.17, -0.05, 0.01, -0.89, -0.84, -0.81, -0.78, -0.75, -0.72, -0.68, -0.65, -0.62, -0.58, -0.56, -0.51, -0.49, -1.24, -1.21, -1.18, -1.15, -1.11, -1.09,
                       -1.05, -1.02, -0.98, -0.94, -0.92, -1.59, -1.56, -1.52, -1.49, -1.46, -1.42, -1.38, -1.34, -1.31, -1.28, -1.89, -1.85, -1.81, -1.78, -1.73, -1.7, -1.67, -1.63, -2.08,
                        -2.03, -2.0, -1.96, -1.92, -0.61, -0.58, -0.54, -0.51, -0.48, -0.44, -0.41, -0.37, -0.34, -0.3, -0.26, -0.21, -0.16, -0.12, -1.0, -0.97, -0.94, -0.91, -0.88, -0.84,
                         -0.8, -0.77, -0.74, -0.71, -0.67, -0.64, -1.34, -1.3, -1.26, -1.23, -1.2, -1.17, -1.14, -1.1, -1.07, -1.04, -1.65, -1.61, -1.58, -1.55, -1.5, -1.47, -1.45, -1.4,
                          -1.37, -1.94, -1.9, -1.87, -1.82, -1.79, -1.75, -1.72, -1.68, -2.07, -2.02, -1.98, -0.16, -0.1, -0.61, -0.57, -0.54, -0.51, -0.49, -0.45, -0.42, -0.38, -0.33, -0.3,
                           -0.26, -0.22, -0.92, -0.9, -0.86, -0.83, -0.8, -0.77, -0.73, -0.7, -0.67, -0.63, -1.21, -1.18, -1.15, -1.12, -1.1, -1.05, -1.03, -0.99, -0.96, -1.5, -1.46, -1.43,
                            -1.39, -1.36, -1.32, -1.29, -1.26, -1.74, -1.71, -1.67, -1.63, -1.6, -1.57, -1.52, -1.99, -1.94, -1.91, -1.87, -1.83, -1.81, -1.78, -2.03, -0.61, -0.58, -0.55,
                             -0.52, -0.49, -0.45, -0.42, -0.39, -0.9, -0.86, -0.83, -0.8, -0.77, -0.73, -0.7, -0.67, -0.64, -1.15, -1.12, -1.09, -1.05, -1.02, -0.99, -0.95, -0.92, -1.39,
                              -1.35, -1.33, -1.28, -1.24, -1.21, -1.18, -1.62, -1.59, -1.55, -1.52, -1.48, -1.45, -1.42, -1.82, -1.79, -1.76, -1.72, -1.69, -1.65, -2.02, -1.97, -1.94, -1.9,
                               -1.87, -0.62, -0.59, -0.55, -0.53, -0.51, -0.48, -0.89, -0.85, -0.81, -0.78, -0.75, -0.71, -0.69, -0.65, -1.1, -1.06, -1.03, -1.01, -0.97, -0.94, -0.91, -1.33,
                                -1.31, -1.28, -1.25, -1.22, -1.18, -1.15, -1.54, -1.51, -1.47, -1.43, -1.4, -1.38, -1.71, -1.69, -1.66, -1.62, -1.57, -1.89, -1.86, -1.83, -1.81, -1.77, -2.05,
                                 -1.99, -1.96, -1.93]
    ys2 = [12.76, 12.99, 12.34, 12.29, 12.34, 12.25, 5.0, 4.99, 5.0, 4.97, 4.98, 4.96, 5.15, 14.53, 4.98, 4.97, 14.35, 14.46, 14.4, 14.4, 14.54, 14.69, 15.19, 15.27, 15.43, 4.99, 5.22, 14.85,
     15.25, 12.5, 12.48, 11.19, 4.75, 4.72, 4.68, 4.62, 4.57, 4.56, 4.54, 4.52, 4.53, 4.48, 4.5, 4.48, 4.48, 4.47, 4.47, 4.46, 4.47, 4.47, 4.46, 4.49, 4.46, 4.5, 4.52, 4.57, 4.58, 4.63, 4.77,
      4.26, 4.28, 4.28, 4.27, 4.29, 4.29, 4.32, 4.3, 4.3, 4.37, 4.49, 4.72, 4.95, 5.23, 5.47, 15.21, 12.62, 12.25, 4.51, 4.48, 4.44, 4.45, 4.4, 4.39, 4.37, 4.38, 4.35, 4.35, 4.31, 4.32, 4.3,
       4.3, 4.31, 4.29, 4.27, 4.28, 4.29, 4.28, 4.12, 4.15, 4.11, 4.13, 4.14, 4.08, 4.07, 4.06, 4.1, 4.1, 4.11, 4.11, 4.17, 4.2, 4.15, 4.14, 4.12, 4.12, 4.51, 4.69, 4.96, 5.22, 5.52, 5.85,
        12.79, 4.33, 4.31, 4.33, 4.34, 4.46, 4.53, 4.2, 4.18, 4.16, 4.14, 4.11, 4.12, 4.12, 4.14, 4.41, 4.65, 4.79, 5.09, 5.42, 5.77, 3.98, 3.97, 3.99, 4.0, 4.04, 3.98, 3.99, 4.22, 4.21,
         4.22, 4.26, 4.2, 4.43, 4.41, 4.48, 3.98, 4.24, 4.45, 4.66, 4.87, 5.16, 5.49, 5.84, 3.91, 3.9, 3.9, 3.9, 3.91, 3.87, 3.89, 3.89, 3.86, 3.87, 3.84, 3.87, 3.84, 3.84, 3.87, 3.86,
          3.85, 3.85, 4.3, 4.42, 4.96, 5.19, 5.4, 5.62, 5.91, 3.67, 3.67, 3.68, 3.75, 4.17, 4.92, 4.88, 4.86, 4.84, 3.76, 3.71, 3.76, 4.12, 4.13, 3.79, 4.96, 3.78, 3.8, 3.81, 3.81, 3.68,
           3.7, 3.68, 3.64, 3.66, 3.85, 3.88, 3.94, 3.95, 3.98, 3.87, 3.77, 3.85, 3.83, 3.66, 3.75, 3.75, 3.76, 3.77, 5.2, 5.41, 5.73, 3.86, 3.65, 3.67, 3.7, 3.75, 3.7, 3.71, 3.84, 3.65,
            3.63, 3.62, 3.66, 3.61, 3.71, 3.69, 4.96, 3.64, 3.67, 3.68, 3.57, 3.69, 4.01, 3.84, 3.84, 3.82, 3.79, 3.72, 3.61, 3.65, 3.68, 3.58, 3.59, 3.53, 3.52, 3.6, 3.78, 3.75, 3.78,
             3.78, 5.26, 5.37, 3.61, 3.56, 3.55, 3.56, 3.56, 3.56, 3.61, 3.6, 3.59, 3.59, 3.58, 3.6, 3.58, 3.61, 3.75, 3.78, 3.72, 3.63, 3.6, 3.62, 3.58, 3.59, 3.59, 3.57, 3.6, 3.57, 3.59,
              4.0, 3.95, 3.79, 3.77, 3.75, 4.43, 4.52, 5.18, 5.56, 5.81, 3.24, 3.25, 3.26, 3.28, 3.3, 3.31, 3.34, 3.33, 3.37, 3.36, 3.44, 3.5, 3.79, 3.94, 4.07, 4.23, 3.23, 3.19, 3.2, 3.19,
               3.18, 3.19, 3.19, 3.21, 3.23, 3.24, 3.24, 3.26, 3.25, 3.38, 3.36, 3.36, 3.33, 3.31, 3.26, 3.23, 3.23, 3.24, 3.23, 11.15, 3.53, 3.49, 3.47, 3.44, 3.42, 3.43, 3.31, 3.41, 3.65,
                3.77, 3.91, 4.04, 4.24, 4.36, 4.67, 5.41, 5.62, 14.92, 3.09, 3.07, 3.1, 3.08, 3.1, 3.12, 3.11, 3.12, 3.14, 3.14, 3.12, 3.16, 3.2, 3.25, 3.06, 3.06, 3.05, 3.04, 3.05, 3.04, 3.04,
                 3.04, 3.04, 3.07, 3.07, 3.27, 3.24, 3.21, 3.18, 3.18, 3.16, 3.12, 3.09, 3.06, 3.07, 9.7, 9.73, 3.4, 3.34, 3.31, 3.32, 3.29, 5.11, 5.46, 6.03, 13.25, 13.21, 2.99, 3.01, 3.07,
                  3.1, 3.16, 3.26, 3.33, 3.44, 3.54, 3.69, 4.01, 4.25, 4.47, 4.78, 2.9, 2.91, 2.9, 2.9, 2.91, 2.93, 2.93, 2.94, 2.93, 2.94, 2.94, 2.93, 2.88, 2.87, 2.88, 2.87, 2.86, 2.86, 2.85,
                   2.86, 2.86, 2.87, 2.87, 3.08, 3.05, 3.03, 3.0, 2.98, 2.97, 2.96, 2.91, 2.87, 8.92, 3.19, 3.1, 3.1, 3.11, 4.05, 4.31, 4.57, 4.91, 5.34, 5.67, 6.11, 11.62, 11.59, 2.78, 2.81, 2.84,
                    2.85, 2.87, 2.92, 2.96, 3.01, 3.06, 3.13, 3.22, 3.42, 3.66, 2.7, 2.72, 2.7, 2.71, 2.7, 2.73, 2.72, 2.72, 2.72, 2.73, 2.77, 2.72, 2.73, 2.69, 2.7, 2.68, 2.68, 2.68, 2.68, 2.7,
                     2.7, 2.84, 2.79, 2.8, 2.77, 2.78, 2.74, 2.73, 2.73, 2.95, 2.89, 2.86, 2.86, 2.84, 2.94, 3.01, 3.07, 3.22, 3.45, 3.74, 3.96, 4.2, 4.45, 4.77, 5.17, 5.51, 5.96, 6.16, 2.63,
                      2.64, 2.65, 2.69, 2.65, 2.73, 2.75, 2.76, 2.76, 2.78, 2.88, 2.91, 2.58, 2.58, 2.57, 2.58, 2.59, 2.6, 2.61, 2.6, 2.63, 2.6, 2.64, 2.64, 2.62, 2.61, 2.6, 2.6, 2.59, 2.59, 2.59,
                       2.74, 2.71, 2.72, 2.68, 2.67, 2.66, 2.65, 2.64, 2.86, 2.79, 2.76, 5.99, 7.93, 2.81, 2.87, 3.09, 3.35, 3.5, 3.77, 4.03, 4.33, 4.73, 5.07, 5.47, 5.61, 2.51, 2.55, 2.55, 2.55,
                        2.58, 2.6, 2.63, 2.67, 2.73, 2.77, 2.44, 2.41, 2.4, 2.43, 2.44, 2.46, 2.49, 2.53, 2.5, 2.55, 2.53, 2.49, 2.48, 2.49, 2.48, 2.47, 2.44, 2.58, 2.58, 2.58, 2.52, 2.56, 2.54,
                         2.51, 2.61, 2.58, 2.51, 2.53, 2.53, 2.58, 2.58, 2.66, 2.83, 2.95, 3.24, 3.4, 3.72, 3.98, 4.27, 5.67, 2.53, 2.53, 2.55, 2.57, 2.6, 2.63, 2.67, 2.71, 2.73, 2.4, 2.42, 2.41,
                          2.45, 2.45, 2.45, 2.48, 2.49, 2.41, 2.43, 2.41, 2.41, 2.38, 2.41, 2.4, 2.43, 2.45, 2.42, 2.45, 2.41, 2.42, 2.42, 2.49, 2.47, 2.47, 2.45, 2.45, 2.45, 2.58, 2.55, 2.53, 2.5,
                           2.49, 2.75, 2.9, 2.91, 3.19, 3.33, 4.45, 2.54, 2.56, 2.55, 2.6, 2.63, 2.63, 2.66, 2.7, 2.4, 2.42, 2.43, 2.44, 2.48, 2.49, 2.54, 2.43, 2.44, 2.63, 2.62, 2.58, 2.56, 2.57,
                            2.47, 2.47, 2.44, 2.45, 2.43, 2.46, 2.5, 2.53, 2.55, 2.5, 2.47, 2.54, 2.61, 2.63, 2.66, 2.6, 2.64, 2.58, 2.53, 2.55]
    zs2 = [-0.56, -0.57, -0.55, -0.55, -0.55, -0.54, -0.34, -0.34, -0.34, -0.34, -0.34, -0.34, -0.34, -0.61, -0.34, -0.34, -0.6, -0.61, -0.6, -0.6, -0.61, -0.61, -0.63, -0.63, -0.63, -0.41, -0.42,
     -0.75, -0.76, -0.67, -0.67, -0.63, -0.4, -0.4, -0.4, -0.4, -0.4, -0.4, -0.4, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39, -0.39,
      -0.39, -0.39, -0.4, -0.4, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.46, -0.47, -0.48, -0.49, -0.5, -0.89, -0.79, -0.78, -0.46, -0.46, -0.46, -0.46, -0.46, -0.46,
       -0.46, -0.46, -0.46, -0.46, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.45, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51,
        -0.51, -0.51, -0.51, -0.51, -0.51, -0.53, -0.54, -0.55, -0.56, -0.57, -0.59, -0.92, -0.52, -0.52, -0.52, -0.52, -0.53, -0.53, -0.52, -0.52, -0.51, -0.51, -0.51, -0.51, -0.51, -0.51, -0.59,
         -0.6, -0.61, -0.63, -0.64, -0.66, -0.57, -0.57, -0.57, -0.57, -0.57, -0.57, -0.57, -0.59, -0.59, -0.59, -0.59, -0.58, -0.6, -0.59, -0.6, -0.63, -0.65, -0.66, -0.67, -0.68, -0.7, -0.72,
          -0.74, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.63, -0.62, -0.66, -0.66, -0.69, -0.77, -0.79, -0.8, -0.82, -0.68,
           -0.68, -0.68, -0.68, -0.71, -0.76, -0.75, -0.75, -0.75, -0.68, -0.68, -0.68, -0.71, -0.71, -0.69, -0.77, -0.69, -0.69, -0.69, -0.69, -0.68, -0.68, -0.68, -0.68, -0.68, -0.69, -0.69,
            -0.7, -0.7, -0.7, -0.7, -0.69, -0.69, -0.69, -0.74, -0.74, -0.75, -0.75, -0.75, -0.85, -0.86, -0.88, -0.76, -0.74, -0.74, -0.74, -0.75, -0.74, -0.74, -0.75, -0.74, -0.74, -0.74, -0.74,
             -0.74, -0.75, -0.75, -0.84, -0.74, -0.74, -0.74, -0.74, -0.74, -0.77, -0.76, -0.76, -0.76, -0.76, -0.75, -0.8, -0.8, -0.8, -0.8, -0.8, -0.79, -0.79, -0.8, -0.81, -0.81, -0.81, -0.81,
              -0.92, -0.93, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.82, -0.82, -0.81, -0.81, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8, -0.8,
               -0.84, -0.83, -0.82, -0.82, -0.82, -0.93, -0.93, -0.99, -1.02, -1.04, -0.83, -0.83, -0.83, -0.83, -0.84, -0.84, -0.84, -0.84, -0.84, -0.84, -0.85, -0.85, -0.88, -0.89, -0.9, -0.91,
                -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.83, -0.85, -0.85, -0.85, -0.85, -0.84, -0.84, -0.84, -0.84, -0.84, -0.83, -1.5, -0.87, -0.86,
                 -0.86, -0.86, -0.85, -0.85, -0.9, -0.91, -0.93, -0.94, -0.95, -0.96, -0.98, -0.99, -1.01, -1.08, -1.1, -1.91, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88,
                  -0.88, -0.88, -0.89, -0.89, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.88, -0.9, -0.9, -0.9, -0.89, -0.89, -0.89, -0.89, -0.88, -0.88, -0.88, -1.48,
                   -1.48, -0.92, -0.91, -0.91, -0.91, -0.91, -1.12, -1.16, -1.21, -1.88, -1.88, -0.93, -0.93, -0.93, -0.94, -0.94, -0.95, -0.96, -0.97, -0.98, -0.99, -1.02, -1.04, -1.06, -1.09,
                    -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.92, -0.95, -0.94,
                     -0.94, -0.94, -0.94, -0.93, -0.93, -0.93, -0.92, -1.5, -0.96, -0.95, -0.95, -0.95, -1.09, -1.12, -1.14, -1.18, -1.22, -1.25, -1.29, -1.84, -1.84, -0.97, -0.97, -0.97, -0.97,
                      -0.97, -0.98, -0.98, -0.99, -0.99, -1.0, -1.01, -1.03, -1.05, -0.96, -0.96, -0.96, -0.96, -0.96, -0.96, -0.96, -0.96, -0.96, -0.96, -0.97, -0.97, -0.97, -0.96, -0.96, -0.96,
                       -0.96, -0.96, -0.96, -0.96, -0.96, -0.98, -0.98, -0.98, -0.97, -0.97, -0.97, -0.97, -0.97, -1.0, -0.99, -0.99, -0.99, -0.98, -1.04, -1.05, -1.05, -1.07, -1.09, -1.12, -1.15,
                        -1.17, -1.2, -1.23, -1.27, -1.31, -1.36, -1.38, -1.01, -1.01, -1.01, -1.01, -1.01, -1.02, -1.02, -1.02, -1.02, -1.02, -1.03, -1.03, -1.01, -1.01, -1.01, -1.01, -1.01, -1.01,
                         -1.01, -1.01, -1.01, -1.01, -1.02, -1.02, -1.01, -1.01, -1.01, -1.01, -1.01, -1.01, -1.01, -1.03, -1.03, -1.03, -1.02, -1.02, -1.02, -1.02, -1.02, -1.05, -1.04, -1.03, -1.59,
                          -1.83, -1.2, -1.21, -1.23, -1.26, -1.28, -1.32, -1.35, -1.39, -1.43, -1.48, -1.52, -1.54, -1.16, -1.17, -1.17, -1.17, -1.17, -1.17, -1.18, -1.18, -1.19, -1.19, -1.16, -1.15,
                           -1.15, -1.15, -1.16, -1.16, -1.16, -1.17, -1.16, -1.17, -1.17, -1.17, -1.16, -1.17, -1.16, -1.16, -1.16, -1.18, -1.18, -1.18, -1.17, -1.18, -1.17, -1.17, -1.19, -1.19,
                            -1.18, -1.18, -1.18, -1.18, -1.18, -1.2, -1.37, -1.39, -1.43, -1.45, -1.5, -1.54, -1.58, -1.77, -1.33, -1.33, -1.34, -1.34, -1.34, -1.35, -1.35, -1.36, -1.36, -1.32,
                             -1.32, -1.32, -1.32, -1.32, -1.32, -1.33, -1.33, -1.32, -1.32, -1.32, -1.32, -1.32, -1.32, -1.32, -1.33, -1.33, -1.33, -1.33, -1.32, -1.32, -1.32, -1.34, -1.34, -1.34,
                              -1.33, -1.33, -1.33, -1.36, -1.35, -1.35, -1.35, -1.34, -1.53, -1.56, -1.56, -1.6, -1.63, -1.8, -1.5, -1.5, -1.5, -1.51, -1.52, -1.52, -1.52, -1.53, -1.48, -1.49,
                               -1.49, -1.49, -1.49, -1.5, -1.5, -1.49, -1.49, -1.52, -1.52, -1.51, -1.51, -1.51, -1.5, -1.5, -1.5, -1.5, -1.49, -1.5, -1.51, -1.51, -1.52, -1.51, -1.5, -1.52, -1.53,
                                -1.53, -1.54, -1.53, -1.54, -1.53, -1.52, -1.52]
    
    time_start = time.time()
    
    pts = np.array((xs2, ys2, zs2)).T
    print('pts', pts.shape)
    
    #~ # 调整角度及位置
    #~ pts[:, 0], pts[:, 1] = transform_2d_point_clouds(pts[:, 0], pts[:, 1], -0.2, 0, 0)
    
    #~ idxs = pts[:, 1] < 11.8
    #~ pts = pts[idxs]
    
    # 对三维点云聚类
    xsc, ysc, zsc, is_clustered = cluster_point_clouds(pts[:, 0], pts[:, 1], pts[:, 2])
    
    # 测试结果
    time_cost = time.time() - time_start
    print('time cost of the process:', round(time_cost, 6), 's')
    
    print('xsc', xsc.shape)
    print('ysc', ysc.shape)
    print('zsc', zsc.shape)
    
    #~ # 打印点云数据
    #~ print('points_x')
    #~ pts_x = xsc
    #~ pts_x = np.around(pts_x, 2)
    #~ pts_x = list(pts_x)
    #~ print(pts_x)
    #~ print('points_y')
    #~ pts_y = ysc
    #~ pts_y = np.around(pts_y, 2)
    #~ pts_y = list(pts_y)
    #~ print(pts_y)
    #~ print('points_z')
    #~ pts_z = zsc
    #~ pts_z = np.around(pts_z, 2)
    #~ pts_z = list(pts_z)
    #~ print(pts_z)
    
    fig, axes = plt.subplots(1, 2, figsize=(8, 4))
    
    # 第一坐标系
    axes[0].set_xticks([])
    axes[0].set_yticks([])
    axes[0].axis('equal')
    axes[0].scatter(pts[:, 0], pts[:, 1], color='gray', s=0.1)
    
    # 第二坐标系
    axes[1].set_xticks([])
    axes[1].set_yticks([])
    axes[1].axis('equal')
    axes[1].scatter(pts[:, 0], pts[:, 1], color='gray', s=0.1)
    axes[1].scatter(xsc, ysc, color='red', s=0.1)
    
    fig.savefig('result', dpi=200)
    plt.show()
